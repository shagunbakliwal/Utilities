=LOWER(TEXTJOIN("_", TRUE, IF(MID(A1, ROW(INDIRECT("1"&":"&LEN(A1))), 1)=UPPER(MID(A1, ROW(INDIRECT("1"&":"&LEN(A1))), 1)), IF(ROW(INDIRECT("1"&":"&LEN(A1)))>1, "_"&MID(A1, ROW(INDIRECT("1"&":"&LEN(A1))), 1), MID(A1, ROW(INDIRECT("1"&":"&LEN(A1))), 1)), MID(A1, ROW(INDIRECT("1"&":"&LEN(A1))), 1))))
